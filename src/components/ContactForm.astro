---
import { useState } from 'preact/hooks';
---

<form id="contactForm" class="space-y-6" action="https://formspree.io/f/your-form-id" method="POST">
  <!-- Champ Prénom -->
  <div>
    <label for="firstname" class="block text-sm font-medium text-primary-dark mb-2">
      Prénom *
    </label>
    <input
      type="text"
      id="firstname"
      name="firstname"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
      placeholder="Votre prénom"
    />
  </div>
  
  <!-- Champ Nom -->
  <div>
    <label for="lastname" class="block text-sm font-medium text-primary-dark mb-2">
      Nom *
    </label>
    <input
      type="text"
      id="lastname"
      name="lastname"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
      placeholder="Votre nom"
    />
  </div>
  
  <!-- Champ Email -->
  <div>
    <label for="email" class="block text-sm font-medium text-primary-dark mb-2">
      Email *
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
      placeholder="votre@email.com"
    />
  </div>
  
  <!-- Champ Téléphone -->
  <div>
    <label for="phone" class="block text-sm font-medium text-primary-dark mb-2">
      Téléphone *
    </label>
    <input
      type="tel"
      id="phone"
      name="phone"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
      placeholder="0467 62 97 96"
    />
  </div>
  
  <!-- Type de projet -->
  <div>
    <label for="service" class="block text-sm font-medium text-primary-dark mb-2">
      Type de projet *
    </label>
    <select
      id="service"
      name="service"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
    >
      <option value="" disabled selected>Sélectionnez votre type de projet</option>
      <option value="maconnerie">Maçonnerie</option>
      <option value="electricite">Électricité</option>
      <option value="plomberie">Plomberie</option>
      <option value="peinture">Peinture</option>
      <option value="carrelage">Carrelage</option>
      <option value="menuiserie">Menuiserie</option>
      <option value="renovation-complete">Rénovation complète</option>
      <option value="autre">Autre</option>
    </select>
  </div>
  
  <!-- Champ Message -->
  <div>
    <label for="message" class="block text-sm font-medium text-primary-dark mb-2">
      Description de votre projet *
    </label>
    <textarea
      id="message"
      name="message"
      rows="5"
      required
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
      placeholder="Décrivez votre projet en détail (surface, travaux souhaités, échéance, etc.)"
    ></textarea>
  </div>
  
  <!-- Champ budget -->
  <div>
    <label for="budget" class="block text-sm font-medium text-primary-dark mb-2">
      Budget estimé (optionnel)
    </label>
    <select
      id="budget"
      name="budget"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
    >
      <option value="" selected>Budget estimé</option>
      <option value="0-5000">Moins de 5 000€</option>
      <option value="5000-10000">5 000€ - 10 000€</option>
      <option value="10000-20000">10 000€ - 20 000€</option>
      <option value="20000-50000">20 000€ - 50 000€</option>
      <option value="50000+">Plus de 50 000€</option>
      <option value="non-defini">Non défini</option>
    </select>
  </div>
  
  <!-- Case à cocher RGPD -->
  <div class="flex items-start">
    <input
      type="checkbox"
      id="privacy"
      name="privacy"
      required
      class="mt-1 mr-3"
    />
    <label for="privacy" class="text-sm text-gray-600">
      J'accepte que mes données personnelles soient utilisées pour me recontacter dans le cadre de ma demande. 
      <a href="/privacy" class="text-primary hover:underline">Politique de confidentialité</a>.
    </label>
  </div>
  
  <!-- Bouton d'envoi -->
  <button
    type="submit"
    class="w-full bg-gradient-to-r from-primary to-accent text-white py-4 rounded-xl font-bold hover:shadow-lg transition-all duration-300"
  >
    ENVOYER MA DEMANDE
  </button>
  
  <p class="text-sm text-gray-500 text-center mt-4">
    * Champs obligatoires. Nous vous recontacterons sous 24h ouvrées.
  </p>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('contactForm');
  
  if (form) {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Validation basique
      const requiredFields = form.querySelectorAll('[required]');
      let isValid = true;
      
      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          isValid = false;
          field.classList.add('border-red-500');
        } else {
          field.classList.remove('border-red-500');
        }
      });
      
      if (!isValid) {
        alert('Veuillez remplir tous les champs obligatoires.');
        return;
      }
      
      // Animation du bouton
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Envoi en cours...';
      submitBtn.disabled = true;
      
      try {
        // Envoi du formulaire (à adapter avec ton service de formulaires)
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });
        
        if (response.ok) {
          // Succès
          form.innerHTML = `
            <div class="text-center py-12">
              <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <h3 class="text-2xl font-bold text-primary-dark mb-4">Message envoyé !</h3>
              <p class="text-secondary mb-6">
                Merci pour votre message. Nous vous recontacterons sous 24h ouvrées.
              </p>
              <a href="/" class="inline-block bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-primary-dark transition">
                Retour à l'accueil
              </a>
            </div>
          `;
        } else {
          throw new Error('Erreur lors de l\'envoi');
        }
      } catch (error) {
        // Erreur
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        alert('Une erreur est survenue. Veuillez réessayer ou nous appeler directement au 0467 62 97 96.');
      }
    });
  }
});
</script>